:figure-caption: Рисунок
:toc:
:toc-title: Оглавление
= Тема работы:Разработка устройства правления яркостью

 Выполнили: Истомин С.В., Соловьев А.А.

==  *Для разработки должна использоваться отладочная плата XNUCLEO-F411RE* +

1)Написать программу, которая по нажатию на User Button зажигает все (4) светодиоды, по следующему нажатию тушит все (4) светодиоды

= Решение

==  *Для измерения напряжения должна использоваться плата Accessories Shield или Analog Test Shield* +


Accessory Shield - это плата расширения Arduino, разработанная компанией Waveshare. Он объединяет множество
популярных периферийных устройств, обеспечивая большую поддержку пользователям в изучении
продуктов серии Arduino и сокращая период разработки.


== *Передача значений по беспроводному интерфейсу должна осуществляться через модуль BlueTooth Bee HC-06* +

Беспроводной модуль для приема/передачи данных в Arduino проектах по протоколу Bluetooth.

Особенности:

* Поддерживает работу с любым USB Bluetooth адаптером;
* Скорость передачи данных: 9600 бит/сек;
* Встроенная антенна;
* Радиус действия до 10 метров;
* Питание 3,3В – 6 В;
* Скорость передачи данных 1200–1382400 бод (1бит/сек);
* Рабочие частоты 2,40 ГГц – 2,48ГГц;

Модуль HC-06 используется только в режиме slave, то есть он не может самостоятельно подключаться к другим устройствам Bluetooth. Все настройки для подключения «пароль, скорость передачи данных» можно изменить при помощи АТ-команд.

Основная функция модуля Bluetooth - это организация связи по последовательному интерфейсу там, где ранее для связи применялась кабельная линия.

= *Основные заводские параметры HC-06:* +

. Режим ведущего: имеет встроенную память, для запоминания последнего связанного ведомого устройства. Устанавливает связь только если на контакт (PIN26) подан низкий уровень. По умолчанию на PIN26 установлен низкий уровень.

. Установка связи: ведущее устройство осуществляет поиск и соединение с ведомым автоматически.

. Основной метод: при выполнении некоторых условий, ведущее и ведомые устройства соединяются автоматически.

. AT режим: До установления связи устройство работает в режиме AT. После установления связи с другим устройством идёт прямая передача информации.

Во время установления связи модуль не может входить в режим AT.

Скорость по умолчанию — 9600.

. Светодиод LED: Период мигания ведомого устройства — 102мс. Если ведущее устройство уже есть в памяти ведомого, то период становится 110мс. Если ведущего устройства в памяти нет, то период моргания 750мс. После установления связи и на ведущем, и на ведомом устройствах контакт светодиода переходит на высокий уровень.

. Энергопотребление: Во времяустановления связи значение тока изменяется от 30 до 40 мА. Среднее значение составляет 25мА. После установления связи, есть ли передача или нет, ток составляет 8мА.

. Сброс: PIN11, низкий уровень активный.

image::twoo.jpg[]
Рисунок 1. Модуль BlueTooth Bee HC-06.

Модуль имеет следующие контакты:

PIN
Описание

PIN1
Передача UART_TXD , уровень ТТЛ/КМОП, вывод данных UART

PIN2
Прием UART_RXD, уровень ТТЛ/КМОП, ввод данных UART

PIN11
Сброс модуля. Подача низкого уровня на контакт приведёт к сбросу.

PIN12
VCC, напряжение питания. Стандартный уровень напряжения составляет 3,3В, диапазон возможных значений 3,0-4,2В

PIN13
GND, заземление

PIN22
GND, заземление

PIN24
LED, Светодиод, индикатор рабочего режима.

PIN26

В случае ведущего устройства контакт обнуляет информацию о запоминаемых устройствах. После обнуления ведущее устройство будет искать ведомое случайным образом. Адрес нового устройства будет записан в память, и в следующий раз в поиске будет только оно.

Для работы HC-06 требует подключения только контактов: UART_TXD, UART_RXD,VCC и GND.
Однако, рекомендуется подключать также LED и KEY (при использовании в качестве ведущего).
Передатчик 3,3В TXD платы микроконтроллера соединяется с приемником UART_RXD модуля HC-06, приемник 3,3В RXD платы соединяется с передатчиком UART_TXD модуля HC-06, питание 3,3В и заземление GND. Это — самая простая схема подключения.

Первое установление связи У ведущего устройства HC-06 до первого включения память пуста. Если введен верный пароль, то ведущее устройство автоматически установит связь с ведомым устройством при первом запуске. Для последующих запусков ведущее устройство запомнит адрес Bluetooth последнего ведомого и будет осуществлять его поиск. Поиск не заканчивается, пока устройство не будет найдено. Если на PIN26 ведущего устройства подан высокий уровень, то память будет очищена. В этом случае, как и при первом запуске, устройство начнёт поиск. Благодаря этой функции ведущее устройство может устанавливать связь с устройством, имеющим определенный адрес.

Формат вывода:
"Давление: " XXX.XX [мм рт.ст.]
"Влажность: " XXX.XX [%]
"Температура: " XXX.XX [℃]
"Точка росы": " XXX.XX [℃]

== *Для подключения модуля BlueTooth должна использоваться плата Accessories Shield или I/O Expansion Shield* +

Accessory Shield - это плата расширения совместимая с популярными платформами для разработки электронных приложений, такими как Arduino UNO, Arduino Leonardo, NUCLEO, XNUCLEO и совместимыми.


image::one.jpg[]
Рисунок 2. Вид платы XNUCLEO-F411RE.


Особенности:
* Разъем расширения для подключения плат Arduino;

* Разъем XBee для подключения беспроводных модулей;

* Индикатор состояния XBee;

* Индикатор питания;

* Кнопка сброса модулей XBee и Arduino;

=== *Компиляция и загрузка программы:* +

. Включите загрузочный режим платы разработки UNO PLUS и установите VCC на 5 В;
. Подключите дополнительный модуль Shield к плате разработки UNO PLUS, а затем плату разработки к вашему ПК с помощью USB-кабеля. Вы можете видеть, что индикатор питания на модуле загорается, когда модуль работает правильно.
. В этом документе представлен метод компиляции и загрузки программы с помощью демо -версии, предоставленной Arduino IDE. Нажмите Файл → Пример → 01.Основы → Мигнуть, чтобы открыть демонстрацию.

== *Интерфейс XBee:* + 

XBee от MaxStream - это модуль беспроводной связи, основанный на технологии ZigBee. Благодаря простому в использовании дизайну он может автоматически передавать введенные данные на другой модуль XBee по беспроводному соединению. И он также поддерживает AT-команды для предварительной настройки.
Установите Дополнительные защитные перемычки:

* Подключите TXD к TX;
* Подключите RXD к RX.

Заводские настройки модуля XBee по умолчанию следующие:

. Скорость передачи данных в бодах: 9600;

. Data Bits: 8;

. Flow Control: NONE;

. Parity: NONE;

. Stop Bits: 1.


== *IO Expansion Shield - это Arduino плата расширения для удобного подключения сенсоров и беспроводных модулей серии BEE.* +

Особенности:

* Интерфейс для подключения сенсоров 3-пин и 4-пин;

* Разъем XBee;

* Разъем для модуля WIFI-LPT100.

Установленные компоненты/интерфейсы на плате:

* Разъем для подключения модулей XBee;

* IIC интерфейс;

* SPI интерфейс;

* Сенсор интерфейс 3-пин (VCC, GND, digital pin);

* Разъем для подключения модуля WIFI-LPT100;

* Сенсор интерфейс 4-пин (VCC, GND, analog pin, digital pin);

* Джампер конфигурации VCC: 3.3В или 5В;

* Джампер выбора отладка/коммуникация;

* Индикаторы состояния XBee и WIFI-LPT100;

* Кнопки WIFI-LPT100 RELOAD, XBee и WIFI-LPT100 RESET, XBee EASYLINK.

image::three.jpg[]
Рисунок 3. Плата IO Expansion Shield


== *Общение с платной модуля BlueTooth должна осуществляться через USART2* +

Режим встроенного загрузчика используется для программирования флэш-памяти с использованием интерфейса: USART2 (PD5/PD6)
В модуле USART можно настраивать следующие параметры:

* Скорость обмена до 4 мбит/c

* Контроль четности

* 1 или 2 стоповых битов

* 8 или 9 бит данных

* Запросы на детектирование ошибок приемо-передачи

* Прерывания по приему, передачи, ошибкам передачи

* Для настройки и работы модуля UART нужны всего несколько регистров

* USART_CR1/CR2/CR3 - регистр настройки 1

* USART_DR - регистр принятого символа (регистр данных)

* USART_BRR – регистр настройки скорости передачи

* USART_SR - регистр состояния

Период вывода информации через BlueTooth модуль должен быть 1 секунда.

Приложение должно быть написано на языке С++ с использование компилятора ARM 9.10
Ядро ARM имеет 4 Гбайт последовательной памяти с адресов 0x00000000 до 0xFFFFFFFF. Различные типы памяти могут быть расположены по эти адресам. Обычно микроконтроллер имеет постоянную память, из которой можно только читать (ПЗУ) и оперативную память, из которой можно читать и в которую можно писать (ОЗУ). Также часть адресов этой памяти отведены под регистры управления и регистры периферии.
Микроконтроллер на ядре Cortex M4 выполнен по Гарвардской архитектуре, память здесь разделена на три типа:

. ПЗУ (FLASH память в которой храниться программа)

. ОЗУ память для хранения временных данных (туда же можно по необходимости переместить программу и выполнить её из ОЗУ), память в которой находятся регистры отвечающие за настройку и работу с периферией

. Память для хранения постоянных данных ЕЕPROM.

Каждый регистр в архитектуре ARM представляет собой ресурс памяти и имеет длину в 32 бита, где каждый бит можно представить в виде выключателя с помощью которого осуществляется управление тем или иным параметром микроконтроллера.

Семейство ARM9 core состоит из ARM9TDMI, ARM940T, ARM9E-S, ARM966E-S, ARM920T, ARM922T, ARM946E-S, ARM9EJ-S, ARM926EJ-S, ARM968E-S, ARM996HS.
Версия 9.10 полного набора инструментов разработки IAR Embedded Workbench for Arm добавляет поддержку 64-битных ядер Arm, включая Arm Cortex-A35, Cortex-A53, Cortex-A55, Cortex-A57 и Cortex-A72.

== *При разработке должна использоваться Операционная Система Реального Времени FreeRTOS и С++ обертка над ней* +

FreeRTOS – бесплатная многозадачная операционная система реального времени (ОСРВ) для встраиваемых систем. Портирована на 35 микропроцессорных архитектур.
Планировщик системы очень маленький и простой, однако можно задать различные приоритеты процессов, вытесняющую и не вытесняющую многозадачность. Ядро системы умещается в 3-4 файлах.

FreeRTOS межзадачная коммуникация (упорядоченная передача информации от одной задачи другой задаче)

События (Как только событие произошло - задача ожидающая это событие переходи в состояние ГОТОВНОСТИ и планировщик в зависимости от приоритета запускает её на исполнение)

Так как мы будем работать именно с FreeRTOS, то надо подключить бибилиотеку: #include "rtos.hpp"


